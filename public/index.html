<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Azee Tourney</title>
    <link rel="stylesheet" href="./main.css">

    <!-- update the version number as needed -->
    <!-- <script defer src="/__/firebase/8.6.2/firebase-app.js"></script> -->
    <!-- include only the Firebase features as you need -->
    <!-- <script defer src="/__/firebase/8.6.2/firebase-auth.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-database.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-firestore.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-functions.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-messaging.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-storage.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-analytics.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-remote-config.js"></script>
    <script defer src="/__/firebase/8.6.2/firebase-performance.js"></script> -->
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <!-- <script defer src="/__/firebase/init.js?useEmulator=true"></script> -->

    <!-- <style media="screen">
      body { background: #ECEFF1; color: rgba(0,0,0,0.87); font-family: Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
      #message { background: white; max-width: 360px; margin: 100px auto 16px; padding: 32px 24px; border-radius: 3px; }
      #message h2 { color: #ffa100; font-weight: bold; font-size: 16px; margin: 0 0 8px; }
      #message h1 { font-size: 22px; font-weight: 300; color: rgba(0,0,0,0.6); margin: 0 0 16px;}
      #message p { line-height: 140%; margin: 16px 0 24px; font-size: 14px; }
      #message a { display: block; text-align: center; background: #039be5; text-transform: uppercase; text-decoration: none; color: white; padding: 16px; border-radius: 4px; }
      #message, #message a { box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24); }
      #load { color: rgba(0,0,0,0.4); text-align: center; font-size: 13px; }
      @media (max-width: 600px) {
        body, #message { margin-top: 0; background: white; box-shadow: none; }
        body { border-top: 16px solid #ffa100; }
      }
    </style> -->
  </head>
  <body>
    <body>
      <div class="panel">
       <h1>
         Azee
       </h1>
     </div>
     <div class="panel">
     <select name="p1select" id="p1">
       <option value="felipe420">Felipe420</option>
       <option value="gritfield">Gritfield</option>
       <option value="bangerz">Bangerz</option>
       <option value="patime">Patime</option>
     </select>
     <select name="p2select" id="p2">
       <option value="felipe420">Felipe420</option>
       <option value="gritfield">Gritfield</option>
       <option value="bangerz">Bangerz</option>
       <option value="patime">Patime</option>
     </select>
     <select name="p3select" id="p3">
       <option value="felipe420">Felipe420</option>
       <option value="gritfield">Gritfield</option>
       <option value="bangerz">Bangerz</option>
       <option value="patime">Patime</option>
     </select>
     <select name="p4select" id="p4">
       <option value="felipe420">Felipe420</option>
       <option value="gritfield">Gritfield</option>
       <option value="bangerz">Bangerz</option>
       <option value="patime">Patime</option>
     </select>
     <select name="winner" id="winner">
       <option value="felipe420">Felipe420</option>
       <option value="gritfield">Gritfield</option>
       <option value="bangerz">Bangerz</option>
       <option value="patime">Patime</option>
     </select>
     <form>
       <label for="fname">Link:</label><br>
       <input type="text" id="link" name="link"><br>
     </form>
     <button id = "submit" type="button">Submit!</button>
     </div>
     <div class="panel" style="font-size: 40px;">
       RESULTS
     </div>
     <div class="panel">
       <button id = "update" type="button">Update!</update></button>
     <table id = "table" style="width:100%">
       <tr>
         <th>Game #</th>
         <th>P1</th>
         <th>P2</th> 
         <th>P3</th>
         <th>P4</th>
         <th>Winner</th>
       </tr>
       
     </table>
     </div>
     
       <div id="chart" >
       </div>
     
      </body>
      <!-- <script type="module" src="index.js"></script> -->
      <script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
      <script>
        // Initialize Firebase
        // TODO: Replace with your project's customized code snippet
        var config = {
          apiKey: "<API_KEY>",
          authDomain: "azee-614e8.firebaseapp.com",
          databaseURL: "https://azee-614e8-default-rtdb.firebaseio.com/",
          // storageBucket: "<BUCKET>.appspot.com",
          // messagingSenderId: "<SENDER_ID>",
        };
        firebase.initializeApp(config);
      
        // Get a reference to the database service
        var database = firebase.database();
        updateTable();
        console.log("start");
        var uid = firebase.auth().currentUser;
        function insertGame(p1, p2, p3, p4, winner, link) {
        var postData = {
            p1: p1,
            p2: p2,
            p3: p3,
            p4: p4,
            winner: winner,
            link: link
          };
        
          // Get a key for a new Post.
          var newPostKey = firebase.database().ref().child('posts').push().key;
        
          // Write the new post's data simultaneously in the posts list and the user's post list.
          var updates = {};
          updates['/STD4P1/' + newPostKey] = postData
          updates['/posts/' + newPostKey] = postData;
          updates['/user-posts/' + uid + '/' + newPostKey] = postData;
          console.log(winner);
          return firebase.database().ref().update(updates);
      }

    function updateTable(){
      var ref = firebase.database().ref();

          ref.on("value", function(snapshot) {
            console.log(snapshot.val()["STD4P1"]);
         
        // HttpGet.onreadystatechange = (e) => {
      let stdTable = snapshot.val()["STD4P1"];

      console.log(typeof(stdTable));
      // console.log(Http.response)
      // console.log(Http.responseText);  
      // table.remove();
      let games = [];
      let numGames = 0;
      for (let key in stdTable){
        let game = stdTable[key];
        // console.log(split_[i]);
        // let short = split_[i].split("(")[1];
        // console.log(short);
        // let game = short.split(",");
        // console.log(game);
        // games.push(game);
        var row = table.insertRow(1);
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        var cell4 = row.insertCell(4);
        var cell5 = row.insertCell(5);
        var link = document.createElement("a");
        console.log(game["link"]);
        if (game["link"] != ""){
          link.setAttribute("href", game["link"]);
          var linkText = document.createTextNode(numGames+1);
          link.appendChild(linkText);

        // Add the link to the previously created TableCell.
          cell0.appendChild(link);
        }
        else{
          cell0.innerHTML = numGames+1;
        }
        // link.setAttribute("href", game["link"]);
        // link.className = "someCSSclass";
        // For IE only, you can simply set the innerText of the node.
        // The below code, however, should work on all browsers.
        
        // cell0.href = "https://azee.mattle.online/room/q82jgWtmZbAsM797W";
        // cell0.innerHTML = game[0];
        cell1.innerHTML = game["p1"];
        cell2.innerHTML = game["p2"];
        cell3.innerHTML = game["p3"];
        cell4.innerHTML = game["p4"];
        cell5.innerHTML = game["winner"];
        numGames++;
      }
      console.log();
      for (let i = table.rows.length-1; i > numGames; i--){
          table.deleteRow(i);
      }

    }, function (error) {
            console.log("Error: " + error.code);
          });
    }

      let submitButton = document.getElementById("submit");
      let p1 = document.getElementById("p1");
      let p2 = document.getElementById("p2");
      let p3 = document.getElementById("p3");
      let p4 = document.getElementById("p4");
      let winner = document.getElementById("winner");
      let link = document.getElementById("link");
      submitButton.addEventListener('click', function(){
          console.log("in submit button");
          insertGame(p1.value, p2.value, p3.value, p4.value, winner.value, link.value);
      });
      let updateButton = document.getElementById("update");
      updateButton.addEventListener('click', function(){
          console.log("in update button");
          updateTable();
      });
        // update the variable when the starCount is changed in the database
        // var starCountRef = database.ref('posts/' + postId + '/starCount');
        // starCountRef.on('value', function(snapshot) {
        //   updateStarCount(postElement, snapshot.val());
        // });
      
        // // update the UI
        // function updateStarCount(el, val) {
        //   el.innerHtml(`${val} Stars!`);
        // }
      </script>

     
      <div class="bottom" id="right">
        Website design by Felipe420
      </div>
     
      <div class="bottom" id="left">
       <a href=" https://azee.mattle.online/lobby/rooms" style="color:black">Azee</a>
     </div>

  <!-- </body> -->
</html>
